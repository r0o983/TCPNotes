# 第九章 连网

## 9.1 拨号连接

调制解调器（modem）通过电话线提供网络访问，它是MOdulate/DEModulate（调制器/解调器的缩写）工程师们生产调制解调器的原因狠简单，他们发现利用世界上最广泛分布的传输介质——全球电话系统——为计算机提供通信由很多好处，最近这些年，电话线已经发展的非常复杂了，有些线路现在能够传递数字化数据，而有些不行，但无论是何种线路，即使是数字电话系统，也不是为了处理像TCP/IP这样的网络协议而设计的，调制解调器的作用在于计算机的数字传输转化为能够通过电话系统的端口进行传输的模拟信号，同时也把来自电话线的模拟信号转化为计算机能够理解的数字信号

### 9.1.1 点到点连接

电话线两端的计算机不需要与其他计算机争用传输介质，它们只需在彼此之间共享介质就可以了，这种连接方式被称为点到点连接

**点对点连接** 

![image-20200506212231806](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506212231806.png)

点到点连接比给予局域网的配置要简单，因为它不需要具备让堕胎计算机共享传输介质的方法，同时，通过电话线的连接也有一些局限性，最大的局限之一是电话连接的传输速率比局域网（比如以太网）要低得多，这导致它使用的协议相当简单，越简单越好，但是随着调制解调器的速度越来越高，调制解调器协议已经承担了额外的职责

拨号协议的另一个巨大挑战是要支持大量不同类型的硬件与软件配置，在局域网上，系统管理员监视和控制每台计算机的配置，协议系统依赖于通信设备之间的高度一致性，拨号连接却与之不同，它几乎可能发生在世界上的任何地点，拨号协议必须适应通信设备的硬件和软件更广泛的差异性

### 9.1.2 调制解调器协议

早期的调制解调器协议只不过是一种在电话线传输信息的方法，在这种情况下，TCP/IP的逻辑寻址和网间错误控制就是没有必要的，随着局域网和Internet的发展，工程师们开始考虑让拨号连接作为提供网络访问的一种方式，这种远程网络访问概念的第一个实现是对早期调制解调器协议的扩展，在这种最初的主机拨号方案中，连接到网络的计算机负责为网络准备数据，无论是显式的还是隐式的，远程计算机都像个终端，通过一个完全独立的过程让连网主机利用调制解调器线路执行连网任务，发送和接收数据

然而，这些早期主机拨号方案有一些局限性，它们反应了早期的中心化计算模式，对提供网络连接的计算机要求过多，而且也不能充分发挥远程计算机的处理能力

**早期的主机拨号配置** 

![image-20200506214705315](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506214705315.png)

随着TCP/IP和其他可路由协议的出现，设计人员构想出了另一种解决方案，让远程计算机负责更多的连网任务，而让拨号服务器发挥类似路由器的作用，这种方案与新式的，弱中心化的计算机网络模式更一致，也接近于TCP/IP的本质特征，在这种安排下，远程计算机运行自己的协议栈，让调制解调器协议工作于网络访问层，拨号服务器接收数据并路由到更大的网络

**真实的TCP/IP拨号连接** 

![image-20200506214924797](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506214924797.png)

这样一来，拨号协议直接与TCP/IP配合工作，并称为协议中的集成部分，最常见的两个TCP/IP调制解调器协议如下所示：

* 穿行线路网际协议（SLIP）：基于TCP/IP的早期调制解调器协议，相对简单，有很多局限性

* 点到点协议（PPP）：最初当前用于调制解调器连接的最流行协议，是对SLIP的细化，具有SLIP所不具备的很多重要特性

  PPP已经渠道SLIP称为拨号Internet连接的协议

**注意：** 低层 

SLIP和PPP都建立于更低级的串行通信协议上，后者负责信号调制和解调的具体细节，这些串行通信协议提供了OSI模型中物理层的功能

### 9.1.3 点到点协议（PPP）

PPP是交互作用的一组协议，实现基于调制解调器连网所需的全部功能，PPP的设计经历了一系列的RFC，目前的PPP标准是RFC1661随后的文档将PPP组件进行了阐述和扩展，RFC1661把PPP组件划分为3大类

* 封装多协议数据报的方法：SLIP和PPP都能接受数据报，转换为适合Internet的形式，但PPP与SLIP不同的是，它还必须准备来自不同协议的数据报

* 建立、配置和测试链接的链接控制协议（LCP）：PPP能够通过协商方式进行配置，从而消除了SLIP连接遇到的兼容问题

* 支持高层协议系统的网络控制协议（NCP）簇：PPP可以包含不同的子层，从而为TCP/IP和其他网络协议提供单独的接口

  PPP大部分功能来自于建立、管理和种植连接的LCP功能

1. PPP数据

   PPP（以及SLIP）的主要用途是转发数据报，其难点在于它必须能够转发多种类型的数据报，也就是说，数据报可能是IP数据报或OSI模型中网络层的其他数据报

   **注意：数据包** PPP RFC使用术语“数据包（packet）”来描述在PPP帧中传输的数据。数据包可以由IP（或其他高层协议）数据报组成，也可以由通过PPP进行操作的其他协议的数据组成。“数据包”这个词在整个网络界用于表示经过网络传输的数据，它并不是很严密的术语。本书中大部分内容会使用更精确的术语，比如“数据报（datagram）”但是，并不是所有的PPP数据包都是数据报，所以为与RFC保持一致，本章课程用术语“数据包”表示经过PPP传输的数据

   PPP也要转发与自己协议相关的信息，这些协议的作用是建立和管理调制解调器连接，通信设备在ppp连接过程中，会交换多种类型的消息和请求，通信计算机必须交换用于建立，管理和关闭连接的LCP数据包，支持PPP身份验证功能（可选）的验证数据包，与各种协议簇通信的NCP数据包，在连接初期交换的LCP数据配置用于全部协议共同的连接参数，NCP协议配置与特定协议簇相关的参数

   ***PPP帧的数据格式，其中包括如下字段** 

   ![image-20200506220300519](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506220300519.png)

   * 协议：1或2字节的字段，提供代表被封装数据包协议类型的标示号，可能的类型包括LCP数据包，NCP数据包，IP数据包和OSI模型网络层协议数据包，ICANN负责规定各种协议类型的标准标识号码
   * 封装的数据（0或多个字节）：帧中传输的控制数据包或高层数据报
   * 填充（可选，长度不定）：协议字段指定的协议所需的额外字节，每个协议自己负责区分填充字节与被封装的数据报

2. PPP连接

   PPP连接的过程如下所示：

   1. 使用LCP协商过程建立连接
   2. 如果第一步的协商过程指定了身份验证要求，通信计算机就进入身份验证阶段，RFC1661提供了密码验证协议（PAP）和挑战握手验证协议（CHAP）这两个可选的验证选项，PPP还支持其他身份验证协议。
   3. PPP利用NCP数据包指定与特定协议相关的配置信息
   4. PPP传输从高层协议接收到的数据，如果第一步的协商过程指定了链接质量监视，监视协议就会传输监视信息，NCP还可能传输与特定协议相关的信息
   5. PPP交换LCP终止数据包来关闭连接

## 9.2 电缆宽带

**典型的电缆调制解调器配置** 

![image-20200506222216091](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506222216091.png)

调制解调器是由调制器和解调器的缩写，与电话调制解调器相同，电缆调制解调器实现数字信号与模拟信号的转换，从而让数据能够通过电缆进行高效传输

名为电缆调制器终端系统（CMTS）的设备，在有线电视提供商网络的接口，接收来自电缆调制解调器的信号，把它转换回数字形式，有线电视提供商再从上游ISP租用宽带线路，利用路由器把用户与Interne连接起来，提供商还可以提供其他服务，比如用DHCP给网络上的用户动态分配IP地址

虽然电缆调制解调器起到了两种不同传输介质的接口的作用，但它并不是一个真正的路由器，更像是一个网桥，电缆调制解调器根据物理地址在网络访问层过滤通信，然而近几年来，有些厂商在一些家用路由器设备中内置了电缆调制解调器，所以我们会看到一些组合设备，它们同时具有路由和电缆调制解调器的功能

早期的电缆调制解调器在早期都使用自己的标准在电缆介质上管理通信，在20世纪90年代末，一些有线电视公司针对电缆调制解调器网络推出了基于电缆服务的数字接口规范（DOCSIS）只要电缆调制解调器终端系统（CMTS）和电缆调制解调器都是与DOCSIS兼容的，用户不需要做任何工作就可以进行连接，但为了防止盗用服务，有线电视公司通常要求用户预先注册电缆调制解调器的MAC地址才能连接网络

## 9.3 数字用户线路（DSL）

另一种适合家用宽带的传输介质就是电话网，电话公司认为使用不同的方法可以得到更好的性能，这就是数字用户线路（DSL）

事实上，电话网使用的双绞线能够提供的容量远超过语音通信的需求，DSL收发器作为局域网与电话网的接口，其工作频率不会影响线路的语音通信，因此DSL工作时不会占用线路或影响电话服务

与电缆相同DSL网络要求在线路另一端也有一台设备接收信号，并且通过服务提供商的网络连接到Internet，这种设备就是“数字服务线路访问多路复用器（DSLAM）”该设备充当DSL连接的另外一端，与电缆网络上一个望断的全部用户共享介质不同，每个DSL用户在收发器与DSLAM之间都是专线连接，所以性能受通信量的影响也比较小，读者可能会觉得，电缆网络与LAN类似，而DSL线路则与点到点电话连接类似

**使用DSL连接到Internet** 

![image-20200507092916566](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507092916566.png)

DSL具有多种形式，包括ADSL（非堆成DSL，用于小型办公室和家庭的最流行方式）、HDSL（高速DSL）、VDSL（甚高速DSL）、SDSL（对称DSL，上行和下行带宽相等）和IDSL（基于DSL的ISDN）从协议层来看，DSL根据装置和实现有多种变化，有些DSL设备集成到了交换机或路由器，有些则充当王巧（类似于电缆调制解调器）在网络访问层根据物理（MAC）地址过滤流量，DSL设备通常用点到点协议（比如PPP）封装数据，比如最流量的基于以太网的PPP（PPPoE）协议

## 9.4 广域网（WAN）

从某种意义上来说，广域网就是Internet本身的核心

广域网的一些形式包括：

* 帧中继
* 综合业务数字网（ISDN）
* 高级数据链路控制（HDLC）
* 乙部传输模式（ATM）

它们是由工作于TCP/IP网络访问层协议进行管理的物理网络规范的另一种形式（广域网协议几乎一直是OSI模型的中心，所以一定记住网络访问层对应于OSI模型的物理层和数据链路层，也就是所谓的第一层和第二层）

服务商运行一个广域网，提供对Internet的访问，也提供对用户分支机构的访问，一个本路环路把提供商的办公室连接到所谓的边界点，也就是客户连接到网络的点，客户提供路由器或其他必要的专用设备，从而通过局域网连接到广域网

**典型的WAN场景** 

![image-20200507095900281](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507095900281.png)

提供商确保从边界点之后的专用带宽和服务级别，服务的安排是多种多样的，可以由专用租借路线组成，也可以基于电路或包交换计量收费

## 9.5 无线网络连接

### 9.5.1 802.11网络

第三章讲到，物理网络的细节存在于TCP/IP协议栈的网络访问层，对无线TCP/IP网络的最简单理解就是在网络访问层使用无线方式连接的普通网络，流行的IEEE 802.11规范为网络访问层进行无线网络连接提供了一个模型

802.11协议栈如图所示，网络访问层的无线组件与以前学习的网络体系是同等的，事实上，802.11因为与IEEE802.3以太网标准的相似性和兼容性，经常被称为无线以太网

**协议位于TCP/IP的网络访问层** 

![image-20200507100412941](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507100412941.png)

从图示可以看出，802.11规范位于OSI参考模型的MAC子层，MAC子层属于OSI模型的数据链路层，从第二章中可以知道，OSI模型数据链路层和物理层对应于TCP/IP的网络访问层，物理层的各种选项分别代表了不同的无线广播形式，包括跳频扩频（FHSS）直接序列扩频（DSSS）正交频复用（OFDM）和高速率直接序列复用（HR/DSSS）

无线网络与有线网络的主要区别就是节点是移动的，换句话说，网络必须能够适应设备位置的改变，但从前面的学子中可以知道，TCP/IP网络的原始传输系统是建立在这种一种假设上：每台设备都位于固定位置，如果一台计算机移动到另一个网段，它必须配置为不同的地址，否则将无法工作，但无线网络上的设备会持续移动，而且在这个环境中虽然保留了以太网的狠多传统，但情况肯定会复杂得多，要求使用新的不同策略

**注意：** 802.11家族

802.11实际上是一系列标准的统称，最初的802.11标准（1997）支持2.4GHz频率范围内最高速率2Mbit/s，802.11a标准支持5GHz频率范围内最高速率54Mbit/s，802.11b标准支持2.4Ghz频率范围内传输速度5.5Mbit/s和11Mbit/s最后出现的标准有802.11g和902.11n

1. 独立网络和基础网络

   无线网络最简单的就是两台或多台具有无限网卡的设备直接相互通信，这种类型的网络的正式名称为独立基本服务集（独立BSS或IBSS）通常被称为ad hoc网络，独立BSS对于小范围内少量计算机来说就够用了。独立BSS的典型示例就是外出归来的笔记本电脑暂时与家用计算机联网，通过无线连接传输文件，在研讨会或销售会议上，与会人员通过无线网络共享信息，就很自然地形成了独立BSS网络，独立BSS网络有一定的局限性，因为它主要依赖参与联网的计算机，没有提供管理连接的基础设备，也不能链接更大的网络，比如局域网或者Internet

   **独立的BSS**

   ![image-20200507103237481](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507103237481.png)

   另外一种无线网络被称为基础基本服务集（基础BSS），基础BSS依赖于一个被称为访问点（Access Point）的固定设备与无线设备实现通信，AP利用无线广播与无线网络通信，它还通过传统方式连接到普通以太网，无线设备通过AP进行通信，如果一台无线设备想与同一区域中的其他无线设备进行通信，它把帧发送给AP，让AP把消息转发给目的，对于传统网络通信，AP就充当网桥的作用，把发给传统网络上设备的帧进行转发，并且把无线网络的通信隔离在无线区域中

   **基础BSS包含一个或多个AP** 

   ![image-20200507103447846](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507103447846.png)

   图上所示的网络让计算机像在有线以太有线网络上那样工作，而且多个访问点通过传统以太网在一起来为较大区域提供服务，基础BSS的配置也有很多好处

   **具有多个AP的基础BSS** 

   ![image-20200507103633059](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507103633059.png)

   802.11的设计目标就是满足上图所示网络的需要，其理念是让移动设备在网络服务区域中漫游时保持连接，首先要说明的是，如果设备需要接收全部网络传输，网络必须知道通过哪个AP能到达该设备，这当然要考虑到设备是可移动的，而且适合的AP也可能在未加提示的情况下发生改变，另外要说明的是，源地址和目的地址的传统概念对于无线网络传输数据来说已经不够用了，802.11帧具有如下4中地址：

   * 目的地址：帧传输的目的设备

   * 源地址：发送帧的设备

   * 接收者地址：应该处理这个802.11帧的无线设备，如果帧要传输到无线设备，接收者地址就与目的地址是一直的，如果帧要传输到无线网络之外，接收者地址就是某个AP地址，该AP会接收这个帧并且把它转发到以太网络

   * 发射者地址：把帧转发给无线网络的设备地址

   * 帧控制：一些较小字段的集合，描述了协议版本，帧类型和解释帧内容所需的其他值

   * 期限/ID：设置传输大致应该持续多长时间，还可以请求AP缓存的帧

   * 地址地段：48位的物理地址，由于802.11有时需要最多4中不同的地址，所以会根据不同类型的帧使用不同的地址字段，第一个字段通常是接收者地址，第二个字段通常是发射者地址

   * 序列控制：片段序号（用于重复片段）以及帧的序列号

   * 帧主体：帧中传输的数据，第二章中已经介绍过，帧中传输的数据包还包含上层协议的报头信息

   * 帧校验序列（FCS）：一个循环冗余校验值，用于检查传输错误并验证帧在传输过程中没有被改变

     **802.11帧格式** 

     ![image-20200507104431375](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507104431375.png)

     由于802.11是个网络访问层的协议集，所以8022.11帧中使用的地址是48位的物理地址，而不是IP地址，当设备在无线网络中移动时，它会向最近可用的AP进行注册（从技术上讲，它会向信号最强，干扰最小的A片注册）这个注册过程被称为关联（association）当设备漫游到另一个访问点附近时，它会重新关联到新的AP，这个关联过程让网络能够知道达到任何一个设备应该使用哪个AP

     **注意：WI-FI联盟** 

     为了确保802.11设备的兼容性，名为无线以太网兼容联盟（WECA，成立于1999年）的组织提供了一个针对无线产品的认证项目，该组织后来将其命名为Wi-Fi联盟，如果想要得到Wi-Fi（无线保真）认证，必须对产品进行测试，以验证它与其他无线设备之间的互操作性

2. 802.11安全

   没有保护的无线网络是很不安全的，在对传统网络进行窃听时，至少需要连接到传输介质上，而对于无线网络来说，在其广播范围之内都可以进行攻击，如果网络没有适当的保护措施，不仅容易被窃听，而且很容易就让非法用户进入到网络

   为了解决这个问题，IEEE制定了一个可选的安全协议用于802.11:有线等效保密（Wired Equivalent Privacy，WEP）标准，其目的是提供与传统有线网络大致相同的保密级别，WEP的目标在于解决如下问题

   * 机密性：防止窃听
   * 完整性：防止数据被篡改
   * 身份验证：对连接团体进行验证，确保他们有操作网络的必要权限

   WEP使用RC4算法进行加密来实现机密性和完整性的目标，发送设备会生成一个完整性校验值（Integrity Check Value，ICV），这个值是基于帧内容进行标准计算而得到的，它使用RC4算法进行加密，传输给接收方接收设备对帧进行解密，计算ICV的值，如果计算后的ICV值与帧中传输的数值相同，就表示帧没有被修改

   然而WEP受到了安全专家们的反对，大多数专家认为WEP是无效的，有些对于WEP的质疑实际上是反对RC4的加密算法的实现，WEP在理论上使用64位密钥，但其中24位是用于初始化的，只有40位用作共享密钥，专家认为40的密钥太短了，所以WEP不能实现有效的保护，专家还质疑密钥管理系统和用于启动加密的24为初始化矢量

   WEP2是对WEP的升级，把初始化矢量增加到128位，并且使用Kerberos身份验证来管理密钥的使用分发，然而WEP2并没有解决WEP的全部问题，因此出现了其他一些协议，比如可扩展身份验证协议（Extensible Authentication Protocal ，EAP）可以解决WEP面临的难题

   作为一个更好的无线安全协议，802.11i标准草案出现于2004年，并在2007年被收入802.11标准，这个新方法也被称为WI-FI保护访问2（WI-FI Protected Access II ，WPA2）使用AES块密码而不是RC4进行加密，而且具有更安全的身份验证和密钥分发过程，WPA2是无线安全领域的一大进步，而且作为无线网络连接使用的首选安全方法对WEP进行了替代

   很多无线设备还支持其他安全方法，例如，很多无线路由器能够让我们输入允许访问网络计算的MAC地址，这种方法能够有效防止邻居盗用我们的带宽，但有经验的入侵者能够绕过这种控制

### 9.5.2 移动IP

最新的IPv4移动标准是RFC5944

移动IP是给固定IP地址关联上一个辅助地址来解决寻址问题，移动IP环境如图所示，设备具有属于家乡网络（Home network）的固定地址，家乡网络上有一个被称为家乡代理（home Agent）的专用路由器，它维护一个表格，把设备的当前位置与固定地址绑定，当设备进入到一个新网络时，它讲注册到该网络中运行的外地代理中（foreign Agent）中，外地代理就把移动设备添加到访问者列表，并且把设备当前位置的信息发送给家乡代理，家乡代理就会用设备的当前位置信息更新自己的移动性绑定表，当发送这台设备的数据报达到家乡网络时，它被封装到一个目标为外地网络的数据包中，最终到达该设备

**移动IP提供了将数据报发送到移动设备的方法** 

![image-20200507111030682](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507111030682.png)

### 9.5.3 蓝牙

蓝牙协议体系是无线设备的另一种规范，蓝牙标准定义了OSI模型中数据链路层和物理层（等效于TCP/IP网络访问层），蓝牙注册商标由蓝牙特别兴趣小组（Special Interest Group ，SIG）持有

蓝牙的设计目标是实现一个小工作区域内一组无线交互设备的通信，在蓝牙的规范中，这个小区域被称为个域网（Personal Area Network，PAN）

像其他无线形式一样，蓝牙使用AP把无线网路哟连接到传统网络，（在蓝牙术语中，这个AP被称为“网络AP”或NAP）蓝牙封装协议能够对进行TCP/IP数据包进行封装，从而在蓝牙网络进行传输

如果一个蓝牙设备可以通过Internet访问，则它必须能够通过TCP/IP访问，厂商预想生产一类兼容Internet的蓝牙设备，通过具有蓝牙功能的Internet网桥连接到Internet，蓝牙NAP设备充当网桥，接收输入的TCP/IP数据，然后用蓝牙网络访问协议替换输入的网络访问层协议，从而把数据传输到接收设备

**具有蓝牙功能的Internet网桥** 

![image-20200507111840799](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507111840799.png)

**注意：** 蓝牙为什么被称为“蓝牙”

蓝牙的名称源自于：Viking King Harald Bluetooth 11世纪丹麦和挪威的统治者，它在观看了德国牧师成功完成奇迹般的挑战之后信了基督教（本来不想写这一段的，但是总要解释一下为什么叫蓝牙吧。。。

## 9.6 连接设备

### 9.6.1 网桥

网桥是根据物理地址过滤和转发数据包的连接设备，它工作于OSi模型的数据链路层（对应于TCP/IP网络的网络访问层），虽然网桥不是路由器，但仍然使用一个路由表作为传输信息的根据

网桥监听它所连接的每个网段，建立一个表来反应物理地址位于哪个网段，当数据在一个网段上传输时，网桥会查看数据的目的地址，与路由表进行比较，如果目的地址属于发送数据的网段，网桥就忽略这个数据，如果目的地址在不同的网段，网桥就把数据转发到适当的网段，如果目的地址不在路由表中，网桥就会把数据转发到除源网段之外的全部网段

**注意：** 网路地址vs逻辑地址

网桥使用的基于硬件的物理地址与逻辑IP地址不同，两者区别请见第一章到第四章

由于网桥只使用网络访问层的物理地址，不检查IP地址报头中的逻辑地址信息，所以不适合连接非同类网络，网桥也不能用于在大型网络（比如：internet）上实现数据转发的IP路由和传输方案

### 9.6.2 HUB

以太网HUB作为一个物理设备从一个端口接收数据，然后把数据重复到其余全部端口，换句话说，全部计算机就好像是被一条连续线路连接在一起的，HUB不会过滤或路由任何数据，只是接收和重新发送信号

基于HUB的以太网兴起的主要原因之一是HUB简化了布线，每台计算机都通过一条线路连接到HUB，可以方便得中断连接和重新连接，在一般办公环境中，计算机通常集中在一个较小的区域，这时使用一个HUB就可以为一组距离很近的计算机提供服务，然后再连接到网络其他部分的HUB，这种把电缆都连接到一台设备的方式让厂家迅速意识到创新的机会，于是出现了更复杂的HUB，即所谓的智能HUB，它具有额外的特性，比如能够检测线路故障和关闭端口，现在HUB基本上已经被交换机取代了

**基于HUB的以太网** 

![image-20200507114435661](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507114435661.png)

### 9.6.3 交换机

基于HUB的以太网仍然面临着传统以太网的主要问题：性能随着流量的上升而下降，只有当线路空闲时，计算机才能进行传输，而且每个网络适配器都必须接收和处理网络上的每个帧，为了解决这些问题，比HUB更智能的设备——交换机——出现了，在其最基本的形式下，交换机类似于上图中所示的HUB，每台计算机也是通过一条线路连接到交换机，但是交换机知道应该把接收到的数据发送到哪一个端口，大多数交换机把端口与所连接适配器的物理地址关联起来，当一个端口所连接的计算机发送数据帧时，交换机会查看帧的目的地址，把帧发送到与目的地址相关联的端口，换句话说，交换机只向应该接收数据的适配器发送数据帧，这样一来，每个适配器就不必查看网络上传输的全部帧，因此，交换机减少了多余的传输，从而改善了网络性能

**交换机将每个端口与物理地址关联起来** 

![image-20200507115305335](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507115305335.png)

**注意：** 前面描述的一类交换机只操作物理地址，不处理IP地址，交换机不是路由器，实际上它更像网桥，准确来说是更像多个网桥结合在一起，交换机对每个网络连接进行隔离，从而只让针对特定计算机的数据进入特定线路

**交换机通过隔离每台计算机来减少流量** 

![image-20200507115453281](https://raw.githubusercontent.com/christopher-x/images/main/image-20200507115453281.png)

现在的交换方式有多种，最常见的两种交换方法如下所示：

* 直通式：交换机一获得目的地址就转发帧

* 存储转发：交换机在转发之前接收整个帧，这种方法会减缓转发过程，但有时可以改善整体性能，因为可以过滤除碎片和其他无效的帧

  交换机在近年来变得非常流行，公司局域网通常会使用分层式的交换机和互连式的交换机来优化性能

  **注意：** 交换机和分层

  有些厂商现在把前面介绍的这种基础交换机概念看做式一个更大类别交换设备的一种特例，更复杂的交换机工作于更高的协议层，能够根据各种参数决定如何转发，在这种更通用的交换方法中，设备根据其工作的OSI协议层进行分类，前面介绍的基本交换机工作于OSI模型的数据链路层，被称为二层交换机，根据IP地址信息进行转发的交换机工作于OSI模型的网络层，被称为第三层交换机（显然，三层交换基本上就式某种路由器了）如果本节没有明确说明交换机是工作于哪一层的，它一般就是工作于第二层的，根据物理（MAC）地址进行过滤

## 9.7 小结

本章介绍了连接Internet或其他大型网络的一些不同的技术，还介绍了调制解调器，点到点连接，主机拨号访问，还讨论了一些流行的宽带技术，比如电缆联网和DSL，以及WAN技术，本章还讨论了一些重要的无线网络协议，介绍了TCP/IP网络上常用的一些连接设备

## 9.8 问与答

问：SLIP和PPP为什么不需要像以太网那样使用完整的物理寻址系统？

**答：** 在点到点连接中，参与连接的两台计算机就位于线路的两端，所以不需要像以太网那样的复杂物理寻址系统，但是SLIP和PPP完全支持使用IP或其他网络层协议的逻辑寻址

问：我的电缆调制解调器每天同一时间都会变得很慢，这是为什么？如何解决？

**答：** 电缆调制解调器与其他设备共享传输介质，在线路使用率高时性能就会下降，除非能够连接到其他网段（基本上是不可能的），否则使用电缆调制解调器就只能这样了，可以尝试其他服务，比如DSL，它能提供更稳定的服务质量，从整体上来说，DSL并不比电缆快，这取决于服务的细节，本地的流量水平和服务提供商

问：移动设备为什么要关键（注册）到AP？
**答：** 来自传统网络的帧被AP转发到所关联的移动设备，通过与AP建立关联，设备就告诉了网络应该把发给自己的帧送到哪个AP

## 9.9 测验

### 9.9.1 问题

1. 用什么在电话线上传输IP数据报而且占据主导地位的协议是什么？

   **答：** PPP（点到点协议）是在电话线路上传输IP数据报最常见协议

2. 说出两种可以在家庭中使用并且基于陆上线路（land-line）的宽带技术

   **答：** 电缆宽带和数字用户线路（DSL）

3. 说出4种WAN技术

   **答：** 帧中继，HDLC，ISND和ATM是四种常见的WAN技术

4. 独立BSS无线网络的另外一个名字是什么？

   **答：** 独立的BSS网络也被称为ad hoc网络

5. HUB与交换机的区别是什么？

   **答：** HUB的功能就是将所得到的数据复制后进行全部转发，而交换机则会根据信息的不同转发到不同的端口（HUB床架了一个类似于传统以太网线路的环境，在其中，它会将所有的消息发送到所有的端口，以便每一台计算机都可以看到这些消息，交换机则维护一个物理地址表，而且只将消息发送给有接收意图的计算机）

### 9.9.2 练习

略

## 9.10 关键术语

复习下列关键术语：

* 802.11:无线通信的协议集，位于TCP/IP协议栈的网络访问层，对应于OSI模型的数据链路层和物理层
* AP：连接无线网络与传统网络的设备，其行为类似于网桥，在无线网络与传统的以太网络之间转发帧
* 关联：无线设备把自己注册到最近AP的过程
* 蓝牙：近距离无线器件和设备使用的协议体系
* 网桥：根据物理地址进行数据转发的连接设备
* 电缆调制解调器终端系统（CMTS）：电缆调制解调器连接到提供商网络的接口设备
* 直通交换：一种交换方式，交换机只要一获得目的地址开始就转发帧
* 基于电缆服务的数字接口规范（DOCSIS）：电缆调制解调器网络的一种规范
* 数字用户线路（DSL）：基于电话线路的一种宽带连接方式
* 数字服务线路访问多路复用器（DSLAM）：DSL连接与提供商网络的接口设备
* HUB：用于连接网络电缆而构成一个网段的设备，HUB一般不过滤数据，只是把接收到的帧转发到全部端口，一度很常见的HUB如今已经被交换机取代，但是要想理解LAN连网设备的演进，HUB相关的知识还是必不可少的
* 独立基本服务集（BBS或IBBS）：无线网络的一种形式，通信的设备互相之间连接也被称为ad hoc网络
* 基础基本服务集（基础BBS）：无线网络的一种形式，无线设备通过连接到传统网络的一个或多个AP进行通信
* 智能HUB：能够执行额外任务的HUB，比如在检测到线路故障时关闭接口
* 链路控制协议（LCP）：PPP用于建立、管理、和终止拨号连接的协议
* 移动IP：一种IP寻址系统，用于支持移动的设备
* 调制解调器：实现数字信号与模拟信号转换的一种设备
* 网络控制协议（NCP）：PPP与特定协议簇交互所用的一组协议
* 点到点连接（PPP）：一种拨号协议，PPP支持TCP/IP和其他网络协议簇，它比SLIP更新，更强大
* 串行线路接口协议（SLIP）：早期的基于TCP/IP的拨号协议
* 存储转发交换：一种交换方式，交换机会先接收整个帧，然后再转发
* 交换机：一种连接设备，它能够掌握与每个端口相关联的地址，把接收到的数据转发到相应的端口，交换机能够根据封装在协议栈报头中的多个参数来决定如何转发数据
* 广域网（WAN）：一些技术的集合，用于在长距离上提供相对快速和高宽带的连接
* Wi-Fi保护访问2（WPA2）：一种高级的无线安全标准，在很大程序上已经取代了WEP，WPA2使用AES块密码来进行加密
* 有线等效保密（WEP）：802.11无线网络中的一种安全标准，WEP现在已经被废弃