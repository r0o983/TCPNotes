# 第七章 应用层

## 基本概念：

TCP/IP栈的顶层是应用层，是位于传输层之上的网络组件的一个松散集合

## 7.1 什么是应用层

应用层位于TCP/IP协议簇的最高层，在这一层中，网络应用程序和服务通过TCP和UDP与低层协议进行通信

TCP/IP这样的分层体系中，每一层都是通向网络的一个接口，应用层必须像传输层一样了解TCP和UDP端口，而且必须响应地传递数据

TCP/IP的应用层是一些能够意识到网络的软件组件，向TCP和UDP端口发送和接收数据，这些组件从逻辑相似性来说并不相同，有的知识收集网络配置的简单工具，而有些则可能是支持桌面操作系统的用户界面系统或者应用编程接口，有些组件为网络提供服务，比如文件和打印服务或名称解析服务

## 7.2 TCP/IP应用层与OSI

TCP/IP并不是与OSI网络模型完全一致的，但是OSI模型影响了网络系统的开发，而且最近多协议联网的发展趋势更加依赖于OSI术语和概念，应用层存在于很多不同的操作系统和网络环境，而在这些环境中，OSI模型是定义和描述网络系统的重要工具，OSI模型能够帮助我们理解TCP/IP应用层中发生的过程

TCP/IP应用层对应OSI模型的应用层、表示层和会话层，OSI模型的细致划分（用三层而不是一层）对TCP/IP所谓的应用程序级（有时也被称为过程/程序级）服务做了进一步的规划

**TCP/IP中的应用层对应于OSI模型中的应用层、表示层和会话层** 

![image-20200506093148796](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506093148796.png)

**对OSI模型响应层的介绍如下** 

* 表示层：OSI的应用层（不要与TCP/IP的应用层混淆）包含的组件为用户应用程序提供服务并支持网络访问
* 表示层：表示层把数据转化为与平台无关的格式，并处理加密的数据压缩
* 会话层：负责管理联网计算机上应用程序之间的通信，提供了一些传输层不具备，与连接相关的功能，比如名称识别和安全

这些服务对应用程序和实现来说并不是必须的，在TCP/IP模型中，各种实现都不必遵循这些OSI细分的层次，但从整体来说，OSI模型中应用层，表示层，会话层的功能都术语TCP/IP应用层职责

## 7.3 网络服务

协议系统中的任何一层都为系统中的其他层提供服务，在大多数情况下，这些服务是定义明确的，术语协议系统的一部分，然而在应用层中，这些服务对于协议软件的运行并不是必须的，更多的是为用户提供方便，或是让本地操作系统连接到网络

客观的说，协议栈中的底层协议与通信机制有关，与日常用户的关系就不明显了，而从另一方面来讲，应用层包含了大量网络服务却是为用户提供的：文件服务，远程访问服务，E-mail和HTTP Web服务协议

**最重要的一些应用层协议和服务** 

![image-20200506093912832](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506093912832.png)

* 文件和打印服务
* 名称解析服务
* 远程访问服务
* Web服务

### 7.3.1 文件和打印服务

打印服务器负责操作打印机，满足针对这台打印机的全部打印请求，文件服务器操作数据存储设备，满足对设备内数据读取和写入的请求

由于文件服务和打印服务台常用了，它们经常会被统一考虑，也就是经常会用一台计算机（有时甚至是同一个服务）来提供文件和打印服务功能，无论这两个服务是否在同一台计算机上，它们的原理是一样的，下图所示为一个典型的文件服务场景，对文件的请求经过网络传递到传输层，后者通过适当的接口把请求路由到发文件服务器的服务程序

**文件服务** 

![image-20200506100055669](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506100055669.png)

文件服务系统，比如UNIX/Linux的网络文件系统（NFS）和MIcrosoft的通用Internet文件系统（CIFS）与服务器信息块（SMB）都工作于应用层，经典的文件传输工具文件传输协议（FTP）和简单文件传输协议（TFTP）

### 7.3.2 名称解析服务

之前讲到，名称解析就是把预定义额，方便用户使用的名称映射为IP地址的过程，域名系统（DNS）服务为Internet提供了名称解析，也能为独立的TCP/IP网络提供名称解析，DNS使用名称服务器解决DNS名称查询，名称服务运行于服务器的应用层，并且与其他名称服务器交换名称解析服务，其他常见的名称解析系统有网络信息服务（NIS），NetBIOS名称解析，还有一些名称服务利用了轻量级目录访问协议（LDAP）

### 7.3.3 远程访问

让用户从一台计算机向另外一台计算机发起交互式连接请求的技术大多集中在应用层，比如之后将介绍的Telnet和SSH就可以让用户通过网络登录到远程系统并发送命令，而现代的屏幕共享工具为桌面GUi系统实现了类似的效果

为了把本地环境与网络集成在一起，有些网络操作系统使用名为重定向器的服务，重定向器有时也被称为请求者

重定向器截获本地计算机上的服务请求，查看这个请求是否可以在本地实现，还是转发到网络中的其他计算机，如果请求针对其他计算机上的服务，重定向器就把请求转发到网络上

**重定向器** 

![image-20200506101635646](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506101635646.png)

重定向器为需要访问网络资源的用户提供了通用的解决方案，就好像这些服务位于本地环境中一样，例如，对一个远程硬盘的操作与对客户端计算机上本地硬盘的操作是一样是

### 7.3.4 Web服务

超文本传输协议（HTTP）是应用层的一个协议，是万维网生态系统的核心，HTTP最初的用途是传输文件和图像，但Web服务模型的发展需要大量与Web相关的协议和组件来建立运行于Web浏览器中的工具

## 7.4 API和应用层

应用编程接口（API）是预定义的编程组件的集合，应用程序可以利用它访问操作环境的其他部分，也就是预操作系统进行通信，网络协议栈就是API概念的典型应用，如下图所示，网络API提供了程序与协议栈的接口，应用程序利用API的函数打开和关闭连接，从网络读取和写入数据

**网络API让应用程序通过TCP/IP访问网络** 

![image-20200506102514578](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506102514578.png)

套接字API最初的开发目的是为了BSD UNIX的应用程序提供了一个访问TCP/IP协议栈的接口，现在已经广泛用于其他系统，作为访问TCP/IP的程序接口，几年前，Microsoft开发了套接字接口的一个版本-WinSock在Window3.1及更早的版本里，用户必须安装和配置WinSock的一个实现才能访问TCP/IP网络，从Windows 95开始微软把TCP/IP程序接口直接嵌入到Windows操作系统中

像套接字API这样的网络API通过套接字接收数据，把数据传递给应用程序，可见，这些API是工作于应用层的

## 7.5 TCP/IP工具

应用层还包含一些TCP/IP工具，这些TCP/IP工具最初是围绕Internet和早期的Unix网络开发的，现在用于配置，管理和诊断全世界的TCP/ip网络，而且有针对WIndows和其他网络操作系统的版本

**TCP/IP工具** 

![image-20200506102931644](https://raw.githubusercontent.com/christopher-x/images/main/image-20200506102931644.png)

## 7.6 小结

本章介绍了TCP/IP应用层，描述了它支持的一些应用程序和服务，还讨论了TCP/IP本身所具有的一些工具

## 7.7 问与答

问：作为文件服务器的计算机处于运行状态，而且也连接到了网络，但用户不能闻坊文件，会是什么问题？

**答：** 多种原因都会导致这种结果，进一步检查特定的操作系统和配置会得到更准确的分析，针对本章讲解的内容，首先检查计算机的文件服务器的服务程序是否运行，文件服务器并不仅仅是一台计算机，它是运行于计算上的一个服务，用于满足文件请求

问：OSI模型为什么把应用层的功能进一步划分为3个单独的层（会话层，表示层和应用层）？

**答：** 应用层提供了广泛的服务，OSI模型对应用层的细分为软件开发人员更好地组织其中的部件提供了一种模块化结构，也为应用程序与协议栈之间的交互提供了更多的选择

## 7.8 测验

### 7.8.1 问题

1. 使用什么网络工具可以检测网络的连通性？

   **答：** ping

2. 什么应用层协议用来载入Web页面？

   **答：** Http协议

3. 哪两种应用层协议用来接收邮件？

   **答：** POP3和ICMP

4. 哪个协议将主机名称映射为IP地址？

   **答：** NDS，域名服务器

5. 哪个协议用来同步计算机的时钟？

   **答：** NIP网络时间协议

### 7.8.2 练习

略

## 7.9 关键术语

复习下列关键术语：

* 应用编程接口（API）：预定义的编程组件的集合，应用程序可以使用它来访问操作系统中的其他部分
* 文件服务：满足网络上对存储介质写入或读取文件
* 打印服务：满足网络上对打印的请求
* 重定向器：检查班底资源请求，根据需要转发到网络
* 套接字API：一种网络API，最初是为了BSD Unix上的应用程序提供TCP/IP接口而开发的